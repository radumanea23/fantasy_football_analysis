<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Matchup Predictions ‚Äì 2025 Week 1</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <nav class="nav">
      <div class="nav-inner">
        <div class="brand">Sean Farrell's Carpool</div>
        <a href="./power-rankings.html">Power Rankings</a>
        <a href="./matchups.html">Matchups</a>
        <a href="./analytics.html">Analytics</a>
        <div class="spacer"></div>
        <span id="week-button" class="badge button">2025 ‚Ä¢ Week 2</span>
        <button id="theme-toggle" class="btn" aria-label="Toggle theme" title="Toggle theme">‚òÄÔ∏è</button>
      </div>
    </nav>
    <div id="week-pop" class="popover" style="display:none;"></div>
    <div class="container">
      <div class="card">
        <h1 class="title">Weekly Matchup Predictions</h1>
        <p class="muted">Predicted winners and reasoning</p>
        <div id="spicy" class="card" style="margin-bottom:16px; display:none;">
          <div class="title" style="display:flex;align-items:center;gap:10px;margin:0 0 8px 0;">
            <span>üå∂Ô∏è Spicy Matchup of the Week</span>
          </div>
          <div id="spicy-reason" class="muted"></div>
        </div>
        <div id="matchups-list" class="grid" style="grid-template-columns:1fr; gap:12px;"></div>
      </div>
    </div>
    <script>
      (function initTheme(){
        const stored = localStorage.getItem('theme') || 'light';
        if (stored === 'dark') document.documentElement.setAttribute('data-theme','dark');
        const btn = document.getElementById('theme-toggle');
        const update = () => { btn.textContent = document.documentElement.getAttribute('data-theme') === 'dark' ? 'üåô' : '‚òÄÔ∏è'; };
        update();
        btn.addEventListener('click', () => {
          const curr = document.documentElement.getAttribute('data-theme');
          const next = curr === 'dark' ? null : 'dark';
          if (next) document.documentElement.setAttribute('data-theme', next); else document.documentElement.removeAttribute('data-theme');
          localStorage.setItem('theme', next ? 'dark' : 'light');
          update();
        });
      })();
    </script>
    <script>
      (function initWeekSwitcher(){
        const btn = document.getElementById('week-button');
        const pop = document.getElementById('week-pop');
        async function buildMenu(){
          const hist = await fetch('./data/2025/history.json').then(r=>r.json()).catch(()=>({weeks:{}}));
          const weeks = Object.keys(hist.weeks||{}).map(n=>parseInt(n,10)).sort((a,b)=>a-b);
          const latest = weeks[weeks.length-1] || 1;
          btn.textContent = `2025 ‚Ä¢ Week ${latest}`;
          pop.innerHTML = weeks.map(w=>`<a href="#" data-week="${w}">2025 ‚Ä¢ Week ${w}</a>`).join('');
          pop.querySelectorAll('a').forEach(a=>{
            a.addEventListener('click', (e)=>{
              e.preventDefault();
              const w = parseInt(a.getAttribute('data-week'),10);
              loadPredictions(w);
              pop.style.display = 'none';
              btn.textContent = `2025 ‚Ä¢ Week ${w}`;
            });
          });
          // Load latest by default
          loadPredictions(latest);
        }
        function place(){
          const rect = btn.getBoundingClientRect();
          pop.style.top = (rect.bottom + window.scrollY + 6) + 'px';
          pop.style.left = (rect.right - 160 + window.scrollX) + 'px';
          pop.style.minWidth = '160px';
        }
        btn.addEventListener('click', ()=>{ if (pop.style.display==='none'){ place(); pop.style.display='block'; } else { pop.style.display='none'; } });
        document.addEventListener('click', (e)=>{ if (!btn.contains(e.target) && !pop.contains(e.target)) pop.style.display='none'; });
        buildMenu();
      })();

      async function loadPredictions(week=1) {
        const season = 2025;
        const [teamsRes, predRes, standingsRes, rostersMinRes, projectionsRes] = await Promise.all([
          fetch('./data/teams.json'),
          fetch(`./data/${season}/week${week}/matchup_predictions.json`),
          fetch(`./data/${season}/standings.json`).catch(()=>({ json:()=>({standings:[]}) })),
          fetch(`./data/${season}/rosters_min.json`).catch(()=>({ json:()=>({rosters:[]}) })),
          fetch(`./data/${season}/week${week}/projections.json`).catch(()=>({ json:()=>({projections:[]}) })),
        ]);
        const teams = await teamsRes.json();
        const preds = await predRes.json();
        const standings = await standingsRes.json();
        const rostersMin = await rostersMinRes.json();
        const projections = await projectionsRes.json();

        const teamByRoster = new Map(teams.teams.map(t => [t.roster_id, t]));
        const standingsByRoster = new Map((standings.standings||[]).map(s => [s.roster_id, s]));
        const startersByRoster = new Map((rostersMin.rosters||[]).map(r => [r.roster_id, (r.starters||[]).slice(0,3)]));
        const projByPid = new Map((projections.projections||[]).map(p => [String(p.player_id), p]));
        const list = document.getElementById('matchups-list');
        list.innerHTML = '';

        // Spicy matchup highlight
        if (preds.spicy_matchup) {
          const s = preds.spicy_matchup;
          const spicy = document.getElementById('spicy');
          const reason = document.getElementById('spicy-reason');
          spicy.style.display = 'block';
          reason.textContent = s.why || '';
        }

        (preds.predictions || []).forEach(p => {
          const home = teamByRoster.get(p.home_roster_id) || { team_name: `Team ${p.home_roster_id}`, avatar_url: '' };
          const away = teamByRoster.get(p.away_roster_id) || { team_name: `Team ${p.away_roster_id}`, avatar_url: '' };
          const hS = standingsByRoster.get(p.home_roster_id) || {wins:0,losses:0,ties:0,pf:0,pa:0};
          const aS = standingsByRoster.get(p.away_roster_id) || {wins:0,losses:0,ties:0,pf:0,pa:0};
          const hTop = (startersByRoster.get(p.home_roster_id) || []).map(t => ({...t, proj: (projByPid.get(String(t.player_id))||{}).points||0})).sort((a,b)=>b.proj-a.proj).slice(0,3);
          const aTop = (startersByRoster.get(p.away_roster_id) || []).map(t => ({...t, proj: (projByPid.get(String(t.player_id))||{}).points||0})).sort((a,b)=>b.proj-a.proj).slice(0,3);
          const winner = p.predicted_winner_roster_id === p.home_roster_id ? home.team_name : away.team_name;
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <div style="display:flex;align-items:flex-start;gap:16px;justify-content:space-between;flex-wrap:wrap;">
              <div style="display:flex;align-items:center;gap:10px;min-width:220px;">
                <img class="rank-avatar" src="${home.avatar_url||''}" alt="home" onerror="this.style.display='none'"/>
                <div>
                  <div style="font-weight:600;">${home.team_name}</div>
                  <div class="muted" style="font-size:12px;">${hS.wins}-${hS.losses}${hS.ties?('-'+hS.ties):''} ‚Ä¢ PF ${hS.pf} ‚Ä¢ PA ${hS.pa}</div>
                </div>
              </div>
              <div class="muted" style="margin:4px 8px;">vs</div>
              <div style="display:flex;align-items:center;gap:10px;min-width:220px;">
                <img class="rank-avatar" src="${away.avatar_url||''}" alt="away" onerror="this.style.display='none'"/>
                <div>
                  <div style="font-weight:600;">${away.team_name}</div>
                  <div class="muted" style="font-size:12px;">${aS.wins}-${aS.losses}${aS.ties?('-'+aS.ties):''} ‚Ä¢ PF ${aS.pf} ‚Ä¢ PA ${aS.pa}</div>
                </div>
              </div>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px;">
              <div>
                <div class="muted" style="font-size:12px;margin-bottom:4px;">Top projected</div>
                ${hTop.map(t=>`
                  <div style=\"display:flex;align-items:center;gap:8px;margin:4px 0;\">
                    <img class=\"rank-avatar\" src=\"https://sleepercdn.com/content/nfl/players/thumb/${t.player_id}.jpg\" onerror=\"this.style.display='none'\" alt=\"headshot\"/>
                    <div>${t.name} <span class=\"muted\" style=\"font-size:12px;\">(${t.position}-${t.nfl_team})</span></div>
                    <div style=\"margin-left:auto;font-weight:600;\">${t.proj.toFixed(1)}</div>
                  </div>
                `).join('')}
              </div>
              <div>
                <div class="muted" style="font-size:12px;margin-bottom:4px;">Top projected</div>
                ${aTop.map(t=>`
                  <div style=\"display:flex;align-items:center;gap:8px;margin:4px 0;\">
                    <img class=\"rank-avatar\" src=\"https://sleepercdn.com/content/nfl/players/thumb/${t.player_id}.jpg\" onerror=\"this.style.display='none'\" alt=\"headshot\"/>
                    <div>${t.name} <span class=\"muted\" style=\"font-size:12px;\">(${t.position}-${t.nfl_team})</span></div>
                    <div style=\"margin-left:auto;font-weight:600;\">${t.proj.toFixed(1)}</div>
                  </div>
                `).join('')}
              </div>
            </div>
            <div style="margin-top:10px;">
              <div><strong>Predicted Winner:</strong> ${winner}</div>
              <div class="muted" style="margin-top:6px;">${p.reasoning || ''}</div>
            </div>
          `;
          list.appendChild(card);
        });
      }
      loadPredictions();
    </script>
    <footer class="footer">
      <div class="footer-inner">
        <div class="muted">¬© 2025 Sean Farrell's Carpool</div>
        <div class="footer-links">
          <a href="https://www.hudl.com/profile/8700482/Dominic-Quigley" target="_blank" rel="noopener noreferrer">Dom's huddle highlights</a>
          <a href="https://github.com/radumanea23/fantasy_football_analysis" target="_blank" rel="noopener noreferrer">Github</a>
        </div>
      </div>
    </footer>
  </body>
  </html>


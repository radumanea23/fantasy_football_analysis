<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Analytics – Power Rankings Trend</title>
    <link rel="stylesheet" href="./styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <nav class="nav">
      <div class="nav-inner">
        <div class="brand">Sean Farrell's Carpool</div>
        <a href="./power-rankings.html">Power Rankings</a>
        <a href="./matchups.html">Matchups</a>
        <a href="./analytics.html">Analytics</a>
        <div class="spacer"></div>
        <span class="badge">2025 • Week 1</span>
        <button id="theme-toggle" class="btn" aria-label="Toggle theme">Light</button>
      </div>
    </nav>
    <div class="container">
      <div class="card">
        <h1 class="title">Power Rankings – Trend</h1>
        <p class="muted">Scatter: x = rank, y = week (hover for team)</p>
        <canvas id="chart" height="120"></canvas>
      </div>
    </div>
    <script>
      (function initTheme(){
        const stored = localStorage.getItem('theme') || 'light';
        if (stored === 'dark') document.documentElement.setAttribute('data-theme','dark');
        const btn = document.getElementById('theme-toggle');
        const update = () => { btn.textContent = document.documentElement.getAttribute('data-theme') === 'dark' ? 'Dark' : 'Light'; };
        update();
        btn.addEventListener('click', () => {
          const curr = document.documentElement.getAttribute('data-theme');
          const next = curr === 'dark' ? null : 'dark';
          if (next) document.documentElement.setAttribute('data-theme', next); else document.documentElement.removeAttribute('data-theme');
          localStorage.setItem('theme', next ? 'dark' : 'light');
          update();
        });
      })();
    </script>
    <script>
      async function loadData() {
        // For now we only have week 1; structure allows future weeks appended
        const resTeams = await fetch('./data/teams.json');
        const teamsJson = await resTeams.json();
        const resHist = await fetch('./data/2025/history.json');
        const hist = await resHist.json();

        // Build scatter points from history: x = week, y = rank
        const points = [];
        const weeks = hist.weeks || {};
        Object.keys(weeks).forEach(wk => {
          const entries = weeks[wk];
          entries.forEach(r => points.push({ x: Number(wk), y: r.rank, team: r.team_name }));
        });
        const ctx = document.getElementById('chart').getContext('2d');
        const chart = new Chart(ctx, {
          type: 'scatter',
          data: {
            datasets: [
              {
                label: 'Week 1',
                data: points,
                borderColor: getComputedStyle(document.documentElement).getPropertyValue('--accent').trim(),
                backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--accent').trim(),
                pointRadius: 5,
                pointHoverRadius: 7,
              },
            ],
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: false },
              tooltip: {
                callbacks: {
                  label: (ctx) => `${ctx.raw.team} – week ${ctx.raw.x}, rank ${ctx.raw.y}`,
                },
              },
            },
            scales: {
              x: {
                title: { display: true, text: 'Week', color: getComputedStyle(document.documentElement).getPropertyValue('--muted').trim() },
                ticks: { color: getComputedStyle(document.documentElement).getPropertyValue('--muted').trim(), stepSize: 1 },
                grid: { color: 'rgba(0,0,0,0.06)' },
                min: 1,
                max: 18,
              },
              y: {
                title: { display: true, text: 'Rank', color: getComputedStyle(document.documentElement).getPropertyValue('--muted').trim() },
                ticks: { color: getComputedStyle(document.documentElement).getPropertyValue('--muted').trim(), stepSize: 1 },
                grid: { color: 'rgba(0,0,0,0.06)' },
                reverse: true,
                min: 1,
              },
            },
          },
        });
      }
      loadData();
    </script>
  </body>
  </html>


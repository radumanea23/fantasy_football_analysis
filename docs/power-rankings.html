<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Power Rankings ‚Äì 2025 Week 1</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <nav class="nav">
      <div class="nav-inner">
        <div class="brand">Sean Farrell's Carpool</div>
        <a href="./power-rankings.html">Power Rankings</a>
        <a href="./matchups.html">Matchups</a>
        <a href="./analytics.html">Analytics</a>
        <div class="spacer"></div>
        <span class="badge">2025 ‚Ä¢ Week 1</span>
        <button id="theme-toggle" class="btn" aria-label="Toggle theme" title="Toggle theme">‚òÄÔ∏è</button>
      </div>
    </nav>
    <div class="container">
      <div class="card">
        <h1 class="title">Power Rankings</h1>
        <p class="muted">Tap a team to expand analysis</p>
        <div id="rankings" class="rankings"></div>
      </div>
    </div>
    <script>
      (function initTheme(){
        const stored = localStorage.getItem('theme') || 'light';
        if (stored === 'dark') document.documentElement.setAttribute('data-theme','dark');
        const btn = document.getElementById('theme-toggle');
        const update = () => { btn.textContent = document.documentElement.getAttribute('data-theme') === 'dark' ? 'üåô' : '‚òÄÔ∏è'; };
        update();
        btn.addEventListener('click', () => {
          const curr = document.documentElement.getAttribute('data-theme');
          const next = curr === 'dark' ? null : 'dark';
          if (next) document.documentElement.setAttribute('data-theme', next); else document.documentElement.removeAttribute('data-theme');
          localStorage.setItem('theme', next ? 'dark' : 'light');
          update();
        });
      })();
    </script>
    <footer class="footer">
      <div class="footer-inner">
        <div class="muted">¬© 2025 Sean Farrell's Carpool</div>
        <div class="footer-links">
          <a href="https://www.hudl.com/profile/8700482/Dominic-Quigley" target="_blank" rel="noopener noreferrer">Dom's huddle highlights</a>
          <a href="https://github.com/radumanea23/fantasy_football_analysis" target="_blank" rel="noopener noreferrer">Github</a>
        </div>
      </div>
    </footer>
    <script>
      async function loadRankings() {
        const res = await fetch('./data/2025/week1/power_rankings.json');
        const data = await res.json();
        const teamsRes = await fetch('./data/teams.json');
        const teamsData = await teamsRes.json();
        const rosterIdToTeam = new Map(teamsData.teams.map(t => [t.roster_id, t]));

        const container = document.getElementById('rankings');
        container.innerHTML = '';

        let expanded = null;
        function collapseAll() {
          [...container.children].forEach(c => c.classList.remove('expanded'));
        }

        data.rankings
          .slice()
          .sort((a,b) => (a.rank||999) - (b.rank||999))
          .forEach(r => {
            const team = rosterIdToTeam.get(r.roster_id) || { team_name: r.team_name, avatar_url: '' };
            const card = document.createElement('div');
            card.className = 'rank-card';
            card.innerHTML = `
              <div class="rank-card-header">
                <div class="rank-num">${r.rank}</div>
                <img class="rank-avatar" src="${team.avatar_url || ''}" alt="avatar" onerror="this.style.display='none'" />
                <div class="rank-team">${team.team_name || r.team_name}</div>
              </div>
              <div class="rank-expand">${r.summary || 'Expand for analysis'}</div>
              <div class="rank-details">
                <div style="font-weight:600;margin-bottom:6px;">Key Players</div>
                <ul class="kp"></ul>
                <div style="font-weight:600;margin:10px 0 6px;">Bench Potential</div>
                <div class="bp"></div>
                <div style="font-weight:600;margin:10px 0 6px;">Make or Break</div>
                <div class="mb"></div>
              </div>
            `;
            card.addEventListener('click', () => {
              if (card.classList.contains('expanded')) {
                card.classList.remove('expanded');
              } else {
                collapseAll();
                card.classList.add('expanded');
              }
            });
            container.appendChild(card);
            // Populate details if present
            const details = card.querySelector('.rank-details');
            const kp = details ? details.querySelector('.kp') : null;
            const bp = details ? details.querySelector('.bp') : null;
            const mb = details ? details.querySelector('.mb') : null;
            const analysis = r.analysis || {};
            if (kp && Array.isArray(analysis.key_players)) {
              analysis.key_players.forEach(k => {
                const li = document.createElement('li');
                li.textContent = `${k.name}: ${k.note}`;
                kp.appendChild(li);
              });
            }
            if (bp) bp.textContent = analysis.bench_potential || '';
            if (mb) mb.textContent = analysis.make_or_break || '';
          });
      }
      loadRankings();
    </script>
  </body>
  </html>

